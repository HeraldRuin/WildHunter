{"version":3,"file":"browser.js","sources":["../../module/media/admin/js/browser.js"],"sourcesContent":["import { createApp } from 'vue'\r\nimport { fileItem, folderItem } from './components'\r\n(function ($) {\r\n    window.uploaderModalApp = createApp({\r\n        data(){\r\n            return {\r\n            files:[],\r\n            viewType:'grid',\r\n            total:0,\r\n            totalPage:0,\r\n            fileTypes:[],\r\n            selected:[],\r\n            selectedLists:[],\r\n            showUploader:false,\r\n            apiFinished:false,\r\n            modalEl:false,\r\n            multiple:false,\r\n            isLoading:false,\r\n            filter:{\r\n                page:1\r\n            },\r\n            onSelect:function () {\r\n\r\n            },\r\n            uploadConfigs:{\r\n                file_type:'default'\r\n            },\r\n            currentFolder:{\r\n                id:0,\r\n                onEdit:false\r\n            },\r\n            folders:[],\r\n            breadcrumbs:[],\r\n            accept_type:bookingCore.media.groups.default.mime.join(',')\r\n        }\r\n        },\r\n        mounted(){\r\n            let me = this;\r\n\r\n            this.modalEl = $('#cdn-browser-modal').modal({\r\n                show:false\r\n            }).on('show.bs.modal',function () {\r\n                me.reloadLists();\r\n                me.reloadFolder();\r\n            });\r\n\r\n            this.$nextTick(function () {\r\n                $(this.$refs.files).change(function () {\r\n                    me.upload(this.files)\r\n                })\r\n            })\r\n\r\n            if(window.localStorage){\r\n                const type = window.localStorage.getItem('bc_media_view_type');\r\n                if(type){\r\n                    this.viewType = type;\r\n                }\r\n            }\r\n\r\n        },\r\n        watch:{\r\n            uploadConfigs(val){\r\n                this.multiple = val.multiple;\r\n                this.onSelect = val.onSelect;\r\n            }\r\n        },\r\n        methods:{\r\n            deletedFolder:function (index){\r\n                this.folders.splice(index,1);\r\n            },\r\n            setViewType:function (type){\r\n                this.viewType = type;\r\n                if(window.localStorage){\r\n                    window.localStorage.setItem('bc_media_view_type',type);\r\n                }\r\n            },\r\n            toggleEditFolder:function (index,val){\r\n                this.folders[index]['onEdit'] = val;\r\n            },\r\n            reloadAll:function (){\r\n                this.filter.page = 1;\r\n                this.reloadLists();\r\n                this.reloadFolder();\r\n            },\r\n            toFolderRoot:function (){\r\n                this.breadcrumbs = [];\r\n                this.currentFolder = {\r\n                    id:0,\r\n                    parent_id:0\r\n                }\r\n                this.filter.page = 1;\r\n                this.reloadLists();\r\n                this.reloadFolder();\r\n            },\r\n            showFolder:function (folder,index){\r\n                if(folder.id === this.currentFolder.id) return;\r\n\r\n                this.breadcrumbs.push(folder);\r\n                if(typeof index != 'undefined'){\r\n                    this.breadcrumbs.splice(index,this.breadcrumbs.length - 1 - index)\r\n                }\r\n                this.currentFolder = folder;\r\n                this.filter.page = 1;\r\n                this.reloadLists();\r\n                this.reloadFolder();\r\n            },\r\n            updateFolder:function (index,folder){\r\n                this.folders[index] = Object.assign({},folder);\r\n            },\r\n            addFolder:function (){\r\n                this.folders.push({\r\n                    id:0,\r\n                    name:'New Folder',\r\n                    onEdit:true,\r\n                    parent_id:this.currentFolder.id\r\n                });\r\n            },\r\n            reloadFolder:function(){\r\n                var me = this;\r\n                $.ajax({\r\n                    url:bookingCore.url+'/media/folder',\r\n                    type:'get',\r\n                    data:{\r\n                        parent_id:this.currentFolder.id,\r\n                    },\r\n                    dataType:'json',\r\n                    success:function (json) {\r\n                        me.folders = json.data;\r\n                    }\r\n                });\r\n            },\r\n            show(configs){\r\n                this.files = [];\r\n                this.resetSelected();\r\n                this.uploadConfigs = configs;\r\n                this.modalEl.modal('show');\r\n                this.accept_type = bookingCore.media.groups[configs.file_type]['mime']\r\n            },\r\n            hide(){\r\n                this.modalEl.modal('hide');\r\n            },\r\n            changePage(p,e){\r\n                e.preventDefault();\r\n                this.filter.page = p;\r\n                this.reloadLists();\r\n            },\r\n            selectFile(file){\r\n                var index = this.selected.indexOf(file.id);\r\n                if (index > -1) {\r\n                    this.selected.splice(index, 1);\r\n                    this.selectedLists.splice(index,1);\r\n                }else{\r\n                    if(!this.multiple){\r\n                        this.selected = [];\r\n                        this.selectedLists = [];\r\n                    }\r\n                    this.selected.push(file.id);\r\n                    this.selectedLists.push(file);\r\n                }\r\n            },\r\n            removeFiles() {\r\n                var me = this;\r\n                bookingCoreApp.showConfirm({\r\n                    message: i18n.confirm_delete,\r\n                    callback: function(result){\r\n                        if(result){\r\n                            me.isLoading = true;\r\n                            $.ajax({\r\n                                url:bookingCore.admin_url+'/module/media/removeFiles',\r\n                                type:'POST',\r\n                                data:{\r\n                                    file_ids : me.selected\r\n                                },\r\n                                dataType:'json',\r\n                                success:function (data) {\r\n                                    if(data.status === 1){\r\n                                        //bookingCoreApp.showSuccess(data);\r\n                                    }\r\n                                    if(data.status === 0){\r\n                                        bookingCoreApp.showError(data);\r\n                                    }\r\n                                    me.isLoading = false;\r\n                                    me.reloadLists();\r\n                                },\r\n                                error:function (e) {\r\n                                    me.isLoading = false;\r\n                                    bookingCoreApp.showAjaxError(e);\r\n                                    me.resetSelected();\r\n                                }\r\n                            });\r\n                        }\r\n                    }\r\n                })\r\n            },\r\n            sendFiles(){\r\n                if(typeof this.onSelect == 'function'){\r\n                    let f = this.onSelect;\r\n                    f(this.selectedLists)\r\n                }\r\n                this.hide();\r\n            },\r\n            init(){\r\n                var  me = this;\r\n                this.reloadLists();\r\n            },\r\n            reloadLists(){\r\n                var me = this;\r\n                $(\"#cdn-browser .icon-loading\").addClass(\"active\");\r\n                me.isLoading = true;\r\n                $.ajax({\r\n                    url:bookingCore.admin_url+'/module/media/getLists',\r\n                    type:'POST',\r\n                    data:{\r\n                        file_type:this.uploadConfigs.file_type,\r\n                        page:this.filter.page,\r\n                        s:this.filter.s,\r\n                        folder_id:this.currentFolder.id\r\n                    },\r\n                    dataType:'json',\r\n                    success:function (json) {\r\n                        me.resetSelected();\r\n                        me.files = json.data;\r\n                        me.total = json.total;\r\n                        me.totalPage = json.totalPage;\r\n                        me.isLoading = false;\r\n                        me.apiFinished = true;\r\n                    }\r\n                });\r\n            },\r\n            upload(files){\r\n                var me = this;\r\n                if(!files.length) return ;\r\n                for(var i = 0; i < files.length ; i++){\r\n                    var d = new FormData();\r\n                    d.append('file',files[i]);\r\n                    d.append('type',this.uploadConfigs.file_type);\r\n                    d.append('folder_id',this.currentFolder.id);\r\n                    me.isLoading = true;\r\n                    $.ajax({\r\n                        url:bookingCore.admin_url+'/module/media/store',\r\n                        data:d,\r\n                        dataType:'json',\r\n                        type:'post',\r\n                        contentType: false,\r\n                        processData: false,\r\n                        success:function (res) {\r\n                            me.isLoading = false;\r\n                            if(res.status)\r\n                            {\r\n                                me.reloadLists();\r\n                            }\r\n                            if(res.status === 0){\r\n                                bookingCoreApp.showError(res);\r\n                            }\r\n                            $(me.$refs.files).val('');\r\n                        },\r\n                        error:function(e){\r\n                            bookingCoreApp.showAjaxError(e);\r\n                            $(me.$refs.files).val('');\r\n                            me.isLoading = false;\r\n                        }\r\n                    })\r\n                }\r\n            },\r\n            initUploader(){\r\n\r\n            },\r\n            resetSelected(){\r\n                this.selectedLists = [];\r\n                this.selected = [];\r\n                this.total = 0;\r\n                this.totalPage = 0;\r\n                this.apiFinished = false;\r\n            }\r\n        },\r\n        components:{\r\n            fileItem,\r\n            folderItem\r\n        }\r\n    });\r\n\r\n    window.uploaderModal = window.uploaderModalApp.mount('#cdn-browser');\r\n})(jQuery);\r\n"],"names":["$","createApp","me","type","val","index","folder","json","configs","p","e","file","result","data","f","files","i","d","res","fileItem","folderItem"],"mappings":"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"}