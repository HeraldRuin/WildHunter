{"version":3,"file":"templateLive.js","sources":["../../module/template/admin/live/components/form.vue","../../module/template/admin/live/components/layers/item.vue","../../module/template/admin/live/index.js"],"sourcesContent":["<template>\r\n    <div\r\n        class=\"d-flex flex-column h-100 \"\r\n    >\r\n        <div class=\"text-center flex-shrink-0\">\r\n            <h5 class=\"modal-title font-weight-medium text-center px-3 py-1  border-bottom-1 border-bottom-solid border-bottom-gray\">{{ currentBlockSetting.name }}</h5>\r\n            <div v-if=\"tabKeys.length\" class=\"form-tabs d-flex align-items-center justify-content-between\">\r\n                <template\r\n                    v-for=\"key in tabKeys\" @click=\"setTab(key)\" :key=\"key\" \r\n                >\r\n                    <div class=\"tab-item py-2 px-1 flex-grow-1\" :class=\"{active:currentTab === key}\">\r\n                        <i v-if=\"tabs[key].icon\" :class=\"tabs[key].icon\"></i>\r\n                        {{ tabs[key].label }}\r\n                    </div>\r\n                </template>\r\n            </div>\r\n        </div>\r\n        <div\r\n            class=\"flex-grow-1 overflow-auto p-3\"\r\n        >\r\n            <vue-form-generator\r\n                v-bind:schema=\"{fields:schema}\" v-bind:model=\"model\" v-bind:options=\"options\"\r\n            ></vue-form-generator>\r\n        </div>\r\n        <div class=\"modal-footer flex-shrink-0 p-2\">\r\n            <button\r\n                type=\"button\"\r\n                class=\"btn btn-secondary\"\r\n                @click=\"hideModal\"\r\n            >{{ template_i18n.cancel }}\r\n            </button>\r\n            <button\r\n                type=\"button\"\r\n                class=\"btn btn-primary\"\r\n                @click=\"saveModal\"\r\n            >{{ template_i18n.save_block }}\r\n                <i\r\n                    class=\"fa fa-spin fa-spinner\"\r\n                    v-show=\"onSaving\"\r\n                ></i>\r\n            </button>\r\n        </div>\r\n    </div>\r\n\r\n</template>\r\n<script>\r\nimport VueFormGenerator from \"@/libs/vue-form-generator/src/formGenerator.vue\";\r\n\r\nexport default {\r\n    data: function () {\r\n        return {\r\n            item: {},\r\n            block: {},\r\n            model: {},\r\n            onEdit: false,\r\n            template_i18n: template_i18n,\r\n            options: {},\r\n            tmp_block: {},\r\n            currentTab: '',\r\n        }\r\n    },\r\n    props: {\r\n        currentModel: {},\r\n        currentBlockSetting: {},\r\n        id: '',\r\n        onSaving:false\r\n    },\r\n    computed: {\r\n        schema() {\r\n            const me = this;\r\n            let settings = this.currentBlockSetting.settings ?? {};\r\n            if (this.currentTab) {\r\n                settings = Object.fromEntries(Object.entries(settings).filter(([_, field]) => {\r\n                    return field.tab === this.currentTab;\r\n                }));\r\n            }\r\n            Object.values(settings).forEach((item) => {\r\n                if (typeof item.conditions === 'undefined') return true;\r\n\r\n                item.visible = function() {\r\n                    var status = true;\r\n                    _.forEach(item.conditions, function(value, key) {\r\n                        if (me.model[key] != value && !value.includes(me.model[key])) {\r\n                            status = false;\r\n                        }\r\n                    });\r\n                    return status;\r\n                };\r\n            });\r\n            return settings;\r\n        },\r\n        tabs() {\r\n            return this.currentBlockSetting.setting_tabs || {};\r\n        },\r\n        tabKeys() {\r\n            const tabs = this.tabs;\r\n            return Object.keys(this.tabs).sort((a) => {\r\n                return (tabs[a]?.order || 0) - (tabs[a]?.order || 0);\r\n            });\r\n        },\r\n    },\r\n    watch: {\r\n        currentModel(val) {\r\n            this.model = Object.assign({}, val ?? {});\r\n        },\r\n        tabKeys(val) {\r\n            this.currentTab = val[0];\r\n        }\r\n    },\r\n    components: {\r\n        \"vue-form-generator\": VueFormGenerator,\r\n    },\r\n    methods: {\r\n        saveModal() {\r\n            this.$emit('save', Object.assign({}, this.model))\r\n        },\r\n        hideModal() {\r\n            this.$emit('cancel')\r\n        },\r\n        setTab(tab) {\r\n            this.currentTab = tab;\r\n        }\r\n    },\r\n    mounted() {\r\n        this.model = Object.assign({}, this.currentModel ?? {});\r\n        this.$nextTick(() => {\r\n\r\n            if (!this.currentTab && this.tabKeys.length) {\r\n                this.currentTab = this.tabKeys[0];\r\n            }\r\n        });\r\n    }\r\n}\r\n</script>\r\n","<template>\r\n\t<div class=\"layer-item\" :class=\"{selected:selectedBlockId === id}\">\r\n\t\t<div class=\" layer-name d-flex justify-content-between align-items-center b-py-0\" :class=\"{'b-pl-2': parent }\">\r\n\t\t\t<!--       Show Arrow icon if there are children or block is container type-->\r\n\t\t\t<svg\r\n\t\t\t\t@click=\"showChildren = !showChildren\"\r\n\t\t\t\tclass=\"b-cursor-pointer b-mr-2 b-w-4 b-h-4\"\r\n\t\t\t\tv-if=\"block.nodes || block.is_container\"\r\n\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\r\n\t\t\t\tfill=\"none\"\r\n\t\t\t\tviewBox=\"0 0 24 24\"\r\n\t\t\t\tstroke-width=\"1.5\"\r\n\t\t\t\tstroke=\"currentColor\"\r\n\t\t\t>\r\n\t\t\t\t<path v-if=\"!showChildren\" stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"m8.25 4.5 7.5 7.5-7.5 7.5\" />\r\n\t\t\t\t<path v-if=\"showChildren\" stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"m19.5 8.25-7.5 7.5-7.5-7.5\" />\r\n\t\t\t</svg>\r\n\t\t\t<div class=\"drag-handler flex-grow-1 b-truncate b-text-sm\" @click.prevent=\"selectBlock\">\r\n\t\t\t\t{{ block.name }}\r\n\t\t\t\t<strong class=\"b-ml-2\" v-if=\"block.type === 'column'\">{{ block.model['size'] }}/12</strong>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"dropdown\" title=\"Options\">\r\n\t\t\t\t<span data-toggle=\"dropdown\" class=\"py-1 px-2\">\r\n\t\t\t\t\t<i class=\"fa fa-cog\"></i>\r\n\t\t\t\t</span>\r\n\t\t\t\t<div class=\"dropdown-menu\" aria-labelledby=\"dropdownMenuButton\">\r\n\t\t\t\t\t<a class=\"dropdown-item text-danger\" @click=\"deleteItem\" href=\"#\">Delete</a>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div class=\"layer-children b-pl-6\" v-show=\"showChildren\">\r\n\t\t\t<layer-item\r\n\t\t\t\tv-if=\"block.nodes\"\r\n\t\t\t\t@select-block=\"emmitSelect\"\r\n\t\t\t\t:selected-block-id=\"selectedBlockId\"\r\n\t\t\t\t:items=\"items\"\r\n\t\t\t\tv-for=\"(childId, index) in block.nodes\"\r\n\t\t\t\t:key=\"index\"\r\n\t\t\t\t:id=\"childId\"\r\n\t\t\t\t:parent=\"id\"\r\n\t\t\t></layer-item>\r\n\t\t\t<div\r\n\t\t\t\tv-if=\"block.is_container\"\r\n\t\t\t\t@click.prevent=\"showAddBlock\"\r\n\t\t\t\tclass=\"b-px-2 b-py-1 b-cursor-pointer b-flex-inline b-items-center\"\r\n\t\t\t>\r\n\t\t\t\t<svg\r\n\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\r\n\t\t\t\t\tfill=\"none\"\r\n\t\t\t\t\tviewBox=\"0 0 24 24\"\r\n\t\t\t\t\tstroke-width=\"1.5\"\r\n\t\t\t\t\tstroke=\"currentColor\"\r\n\t\t\t\t\tclass=\"b-w-4 b-h-4\"\r\n\t\t\t\t>\r\n\t\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M12 4.5v15m7.5-7.5h-15\" />\r\n\t\t\t\t</svg>\r\n\t\t\t\t<span v-if=\"block.type == 'row'\">{{ i18n.add_column }}</span>\r\n\t\t\t\t<span v-else>{{ i18n.add_children }}</span>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n</template>\r\n\r\n<script>\r\n\r\nexport default {\r\n  name: 'layer-item',\r\n  data: function () {\r\n    return {\r\n      i18n: template_i18n,\r\n      showChildren: false\r\n    }\r\n  },\r\n  props: {\r\n    items: {},\r\n    id: '',\r\n    selectedBlockId: '',\r\n    parent: ''\r\n  },\r\n  computed: {\r\n    block() {\r\n      return this.items[this.id] ?? {}\r\n    }\r\n  },\r\n  methods: {\r\n    selectBlock() {\r\n\t\twindow.LiveEditorEventBus.emit('select-block', this.id);\r\n    },\r\n    emmitSelect(id) {\r\n\t\twindow.LiveEditorEventBus.emit('select-block', id);\r\n    },\r\n    sortEnd(val) {\r\n      console.log(val)\r\n    },\r\n    deleteItem() {\r\n      if (!confirm(this.i18n.delete_confirm)) return;\r\n\r\n      window.LiveEditorEventBus.emit('delete-item', {\r\n        id: this.id\r\n      })\r\n    },\r\n    showAddBlock() {\r\n      // if current block is row, add a sample column to it\r\n      if (this.block.type === 'row') {\r\n        window.LiveEditorEventBus.emit('add-block', {\r\n          to: this.id,\r\n          children: [{\r\n            id: 'column',\r\n            model: {\r\n              size: 6 //  Default is 6/12\r\n            },\r\n            parent: this.id\r\n          }]\r\n        })\r\n      } else {\r\n        window.LiveEditorEventBus.emit('show-add-block', {\r\n          id: this.id,\r\n        })\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n","import { createApp } from \"vue\";\r\nimport Form from \"./components/form.vue\";\r\nimport LayerItem from \"./components/layers/item.vue\";\r\nimport draggable from \"vuedraggable\";\r\nimport mitt from \"mitt\";\r\nimport VueFormGenerator from \"@/libs/vue-form-generator/src/formGenerator.vue\";\r\nimport {install} from \"../custom-fields\"\r\n\r\nwindow.LiveEditorEventBus = mitt();\r\n\r\nwindow.LiveEditor = createApp({\r\n  data: () => ({\r\n    items: current_template_items,\r\n    blocks: [],\r\n    message: {\r\n      content: \"\",\r\n      type: false,\r\n    },\r\n    onSaving: false,\r\n    s: \"\",\r\n    selectedBlockId: \"\",\r\n    frame: null,\r\n    showAddBlock: false,\r\n    lastSaved: current_last_saved,\r\n    addBlockForId: null, // id of parent block\r\n    model:{},\r\n    options:{},\r\n    schema: [\r\n        {\r\n          \"id\": \"title\",\r\n          \"type\": \"input\",\r\n          \"inputType\": \"text\",\r\n          \"label\": \"Title\",\r\n          \"adminLabel\": true,\r\n          \"model\": \"title\"\r\n        },\r\n      ]\r\n  }),\r\n  mounted() {\r\n    this.reloadBlocks();\r\n\r\n    this.$nextTick(() => {\r\n      window.addEventListener(\"message\", (messageStr) => {\r\n        try {\r\n          const message = JSON.parse(messageStr.data);\r\n          if (message?.action) {\r\n            switch (message?.action) {\r\n              case \"select-item\":\r\n                this.selectItemFromFrame(message?.data.id);\r\n                break;\r\n            case \"show-add-layer\":\r\n              this.showAddBlock = true;\r\n              break;\r\n            }\r\n          }\r\n        } catch (error) {\r\n          console.log(error);\r\n        }\r\n      });\r\n\r\n      this.sendToFrame({\r\n        action: \"set_items\",\r\n        data: this.items,\r\n      });\r\n    });\r\n    window.LiveEditorEventBus.on(\"delete-item\", (data) => {\r\n      this.deleteItem(data);\r\n    });\r\n    window.LiveEditorEventBus.on(\"show-add-block\", (data) => {\r\n      this.showAddBlock = true;\r\n      this.addBlockForId = data?.id;\r\n    });\r\n\r\n    // allow children to trigger event to add block\r\n    window.LiveEditorEventBus.on(\"add-block\", (data) => {\r\n      if (Boolean(data?.children?.length) && data.to) {\r\n        data?.children?.forEach((item) => {\r\n          // clone the bloc\r\n          this.addBlockTo(data.to, { ...item });\r\n        });\r\n      }\r\n    });\r\n    window.LiveEditorEventBus.on(\"select-block\", (id) => {\r\n      this.selectBlock(id);\r\n    });\r\n  },\r\n  computed: {\r\n    filteredBlocks: function () {\r\n      const res = {};\r\n      if (!this.s) return this.blocks;\r\n\r\n      Object.entries(this.blocks).forEach(([groupId, group]) => {\r\n        res[groupId] = Object.assign({}, group);\r\n        res[groupId].items =\r\n          group.items.filter((item) => {\r\n            return item.name.toLowerCase().includes(this.s.toLowerCase());\r\n          }) || [];\r\n      });\r\n      return res;\r\n    },\r\n    blocksMapById() {\r\n      let res = {};\r\n      Object.entries(this.blocks).forEach(([, group]) => {\r\n        group.items.forEach((item) => {\r\n          res[item.id] = item;\r\n        });\r\n      });\r\n      return res;\r\n    },\r\n    currentModel() {\r\n      return this.items[this.selectedBlockId].model ?? {};\r\n    },\r\n    currentBlockSetting() {\r\n      return this.blocksMapById[this.items[this.selectedBlockId].type] ?? {};\r\n    },\r\n  },\r\n  watch: {\r\n    currentModel(val) {\r\n      console.log(val)\r\n    },\r\n  },\r\n  methods: {\r\n    sendToFrame(data) {\r\n      const iframeEl = document.getElementById(\"frame-preview\");\r\n      if (iframeEl && iframeEl.contentWindow) {\r\n        iframeEl.contentWindow.postMessage(JSON.stringify(data), \"*\");\r\n      }\r\n    },\r\n    reloadBlocks() {\r\n      var me = this;\r\n\r\n      jQuery.ajax({\r\n        url: bookingCore.admin_url + \"/module/template/getBlocks\",\r\n        dataType: \"json\",\r\n        type: \"get\",\r\n        success: function (res) {\r\n          if (res.status) {\r\n            me.blocks = res.data;\r\n          }\r\n        },\r\n        error: function (e) {\r\n          console.log(e);\r\n        },\r\n      });\r\n    },\r\n    selectBlock(id) {\r\n      this.selectedBlockId = id;\r\n      this.sendToFrame({\r\n        action: \"select-item\",\r\n        data: id,\r\n      });\r\n    },\r\n    selectItemFromFrame(id) {\r\n      this.selectedBlockId = id;\r\n    },\r\n    saveTemplate() {\r\n      var me = this;\r\n\r\n      this.onSaving = true;\r\n\r\n      $.ajax({\r\n        url: bookingCore.admin_url + \"/module/template/store\",\r\n        dataType: \"json\",\r\n        type: \"post\",\r\n        data: {\r\n          id: template_id,\r\n          content: JSON.stringify(this.items),\r\n          title: this.title,\r\n          lang: current_menu_lang,\r\n        },\r\n        success: function (res) {\r\n          me.onSaving = false;\r\n          me.lastSaved = res.lastSaved;\r\n          if (res.message) {\r\n            me.message.content = res.message;\r\n            me.message.type = res.status;\r\n          }\r\n          if (res.url) {\r\n            window.location.href = res.url;\r\n          }\r\n\r\n          window.setTimeout(() => {\r\n            me.message.content = \"\";\r\n          }, 3000);\r\n        },\r\n        error: function (e) {\r\n          me.onSaving = false;\r\n\r\n          if (e.responseJSON.message) {\r\n            me.message.content = e.responseJSON.message;\r\n            me.message.type = false;\r\n          } else {\r\n            me.message.content = \"Can not save menu\";\r\n            me.message.type = false;\r\n          }\r\n        },\r\n      });\r\n    },\r\n    cancelEdit() {\r\n      this.selectedBlockId = \"\";\r\n    },\r\n    saveBlock(model) {\r\n      if (this.selectedBlockId && this.items[this.selectedBlockId]) {\r\n        this.items[this.selectedBlockId].model = model;\r\n        this.sendToFrame({\r\n          action: \"save_block\",\r\n          data: {\r\n            id: this.selectedBlockId,\r\n            model,\r\n            tree: this.getTreeForNodeId(this.selectedBlockId),\r\n          },\r\n        });\r\n        this.saveTemplate();\r\n      }\r\n    },\r\n    sortEnd(val) {\r\n      this.saveTemplate();\r\n      this.sendToFrame({\r\n        action: \"sort-end\",\r\n        data: val.moved,\r\n      });\r\n    },\r\n    deleteItem(data) {\r\n      const itemId = data.id;\r\n      const itemObj = this.items[itemId];\r\n      if (typeof itemObj !== \"undefined\") {\r\n        this.selectedBlockId = \"\";\r\n\r\n        const parentNodes = this.items[itemObj.parent].nodes;\r\n        if (typeof parentNodes !== \"undefined\" && parentNodes.indexOf(itemId) !== -1) {\r\n          this.items[itemObj.parent].nodes.splice(parentNodes.indexOf(itemId), 1);\r\n        }\r\n        delete this.items[itemId];\r\n\r\n        this.sendToFrame({\r\n          action: \"delete-item\",\r\n          data,\r\n        });\r\n        this.saveTemplate();\r\n      }\r\n    },\r\n    addBlock(block) {\r\n      this.addBlockTo(this.addBlockForId || \"ROOT\", block);\r\n    },\r\n    addBlockTo(parentId, block, options) {\r\n      const newId = this.makeid(20);\r\n\r\n      // Make sure that block exists\r\n      // Find a again by type\r\n      const findBlock = this.blocksMapById[block.id];\r\n      if (!findBlock) {\r\n        console.log(\"No findBlock\", findBlock, block);\r\n        return;\r\n      }\r\n      // Clone to make sure no issue\r\n      const blockParams = this.getBlockParams({ ...findBlock });\r\n\r\n      blockParams.parent = parentId;\r\n      if (!this.items[parentId]) {\r\n        console.log(\"No parentId\" + parentId, findBlock, block);\r\n        return;\r\n      }\r\n      // make sure block.nodes is not empty\r\n      this.items[parentId].nodes = this.items[parentId].nodes || [];\r\n\r\n      this.items[parentId].nodes.push(newId);\r\n      this.items[newId] = blockParams;\r\n\r\n      if (parentId !== \"ROOT\") {\r\n        // trigger update event to preview iframe with no new props to parent\r\n        // so that parent will show new child\r\n        this.sendToFrame({\r\n          action: \"save_block\",\r\n          data: {\r\n            id: parentId,\r\n            model: {},\r\n            tree: this.getTreeForNodeId(this.parentId),\r\n          },\r\n        });\r\n      } else {\r\n        // Trigger add block event\r\n        this.sendToFrame({\r\n          action: \"add_block\",\r\n          data: {\r\n            id: newId,\r\n            model: block.model,\r\n            blockType: block.id,\r\n          },\r\n        });\r\n      }\r\n\r\n      // Support preset_children\r\n      // Eg section will have some default columns\r\n      if (Boolean(block.preset_children?.length)) {\r\n        // add each items to newId\r\n        // NOTE: Only support 1 level\r\n        // TODO: Support for nested preset_children\r\n        block.preset_children.forEach((preset) => {\r\n          const newBlock = { ...preset }; // Clone preset\r\n\r\n          this.addBlockTo(newId, newBlock, {\r\n            noActiveBlock: false, // this flag mean we dont want to auto select this block after add it\r\n          });\r\n        });\r\n      }\r\n\r\n      this.$nextTick(() => {\r\n        // Check if there is no flag\r\n        // If parent is not ROOT, we will auto select block\r\n        if (!Boolean(options?.noActiveBlock) && parentId !== \"ROOT\") {\r\n          this.selectBlock(newId);\r\n        }\r\n        this.showAddBlock = false;\r\n      });\r\n    },\r\n    getBlockParams(block) {\r\n      let res = {\r\n        type: block.id,\r\n        name: block.name,\r\n        model: block.model,\r\n        component: block.component,\r\n        open: true,\r\n      };\r\n\r\n      if (block.is_container) {\r\n        res.is_container = true;\r\n        res.children = [];\r\n      }\r\n\r\n      return res;\r\n    },\r\n    makeid(length) {\r\n      let result = \"\";\r\n      const characters = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";\r\n      const charactersLength = characters.length;\r\n      let counter = 0;\r\n      while (counter < length) {\r\n        result += characters.charAt(Math.floor(Math.random() * charactersLength));\r\n        counter += 1;\r\n      }\r\n      return result.toLowerCase();\r\n    },\r\n    // Return tree data related to node id\r\n    getTreeForNodeId(nodeId, level = 0) {\r\n      let res = {};\r\n      if (level === 0 && this.items[nodeId]) {\r\n        // add current item\r\n        res[nodeId] = this.items[nodeId];\r\n      }\r\n      if (Boolean(this.items[nodeId]?.nodes)) {\r\n        this.items[nodeId].nodes.forEach((childNodeId) => {\r\n          if (this.items[childNodeId]) {\r\n            res[childNodeId] = this.items[childNodeId];\r\n          }\r\n\r\n          // Support nested\r\n          res = { ...res, ...this.getTreeForNodeId(childNodeId, level + 1) };\r\n        });\r\n      }\r\n      return res;\r\n    },\r\n  },\r\n  components: {\r\n    BlockForm: Form,\r\n    LayerItem,\r\n    draggable,\r\n    VueFormGenerator\r\n  },\r\n});\r\n\r\nwindow.LiveEditor.mount(\"#live-editor\");\r\n\r\ninstall(window.LiveEditor);\r\n"],"names":["_sfc_main","me","settings","_","field","item","status","value","key","tabs","a","val","VueFormGenerator","tab","_hoisted_1","_hoisted_2","_hoisted_3","_hoisted_5","_hoisted_6","_hoisted_7","_openBlock","_createElementBlock","_createElementVNode","_toDisplayString","$props","$options","_hoisted_4","_Fragment","_renderList","_normalizeClass","_ctx","_createTextVNode","_createVNode","_component_vue_form_generator","args","_withDirectives","id","_cache","$event","childId","index","_createBlock","_component_layer_item","_hoisted_8","mitt","createApp","messageStr","message","error","data","res","groupId","group","iframeEl","e","model","itemId","itemObj","parentNodes","block","parentId","options","newId","findBlock","blockParams","preset","newBlock","length","result","characters","charactersLength","counter","nodeId","level","childNodeId","Form","LayerItem","draggable","install"],"mappings":"4MAgDA,MAAKA,EAAU,CACX,KAAM,UAAY,CACd,MAAO,CACH,KAAM,CAAA,EACN,MAAO,CAAA,EACP,MAAO,CAAA,EACP,OAAQ,GACR,cACA,QAAS,CAAA,EACT,UAAW,CAAA,EACX,WAAY,EAChB,CACJ,EACA,MAAO,CACH,aAAc,CAAA,EACd,oBAAqB,CAAA,EACrB,GAAI,GACJ,SAAS,IAEb,SAAU,CACN,QAAS,CACL,MAAMC,EAAK,KACX,IAAIC,EAAW,KAAK,oBAAoB,UAAY,CAAA,EACpD,OAAI,KAAK,aACLA,EAAW,OAAO,YAAY,OAAO,QAAQA,CAAQ,EAAE,OAAO,CAAC,CAACC,EAAGC,CAAK,IAC7DA,EAAM,MAAQ,KAAK,UAC7B,CAAC,GAEN,OAAO,OAAOF,CAAQ,EAAE,QAASG,GAAS,CACtC,GAAI,OAAOA,EAAK,WAAe,IAAa,MAAO,GAEnDA,EAAK,QAAU,UAAW,CACtB,IAAIC,EAAS,GACb,SAAE,QAAQD,EAAK,WAAY,SAASE,EAAOC,EAAK,CACxCP,EAAG,MAAMO,CAAG,GAAKD,GAAS,CAACA,EAAM,SAASN,EAAG,MAAMO,CAAG,CAAC,IACvDF,EAAS,GAEjB,CAAC,EACMA,CACX,CACJ,CAAC,EACMJ,CACX,EACA,MAAO,CACH,OAAO,KAAK,oBAAoB,cAAgB,EACpD,EACA,SAAU,CACN,MAAMO,EAAO,KAAK,KAClB,OAAO,OAAO,KAAK,KAAK,IAAI,EAAE,KAAMC,IACxBD,EAAKC,CAAC,GAAG,OAAS,IAAMD,EAAKC,CAAC,GAAG,OAAS,EACrD,CACL,GAEJ,MAAO,CACH,aAAaC,EAAK,CACd,KAAK,MAAQ,OAAO,OAAO,CAAA,EAAIA,GAAO,CAAA,CAAE,CAC5C,EACA,QAAQA,EAAK,CACT,KAAK,WAAaA,EAAI,CAAC,CAC3B,GAEJ,WAAY,CACR,qBAAsBC,GAE1B,QAAS,CACL,WAAY,CACR,KAAK,MAAM,OAAQ,OAAO,OAAO,GAAI,KAAK,KAAK,CAAC,CACpD,EACA,WAAY,CACR,KAAK,MAAM,QAAQ,CACvB,EACA,OAAOC,EAAK,CACR,KAAK,WAAaA,CACtB,GAEJ,SAAU,CACN,KAAK,MAAQ,OAAO,OAAO,CAAA,EAAI,KAAK,cAAgB,CAAA,CAAE,EACtD,KAAK,UAAU,IAAM,CAEb,CAAC,KAAK,YAAc,KAAK,QAAQ,SACjC,KAAK,WAAa,KAAK,QAAQ,CAAC,EAExC,CAAC,CACL,CACJ,EAlIQC,EAAA,CAAA,MAAM,0BAA2B,EAE5BC,EAAA,CAAA,MAAM,2BAA2B,EAC9BC,EAAA,CAAA,MAAM,6GAA8G,WAC7F,MAAM,+DAYjCC,EAAA,CAAA,MAAM,+BAA+B,EAMpCC,EAAA,CAAA,MAAM,gCAAgC,EAa/BC,EAAA,CAAA,MAAM,uBAAuB,0DApC7C,OAAAC,EAAA,EAAAC,EAyCM,MAzCNP,EAyCM,CAtCFQ,EAYM,MAZNP,EAYM,CAXFO,EAA4J,KAA5JN,EAA4JO,EAAhCC,EAAA,oBAAoB,IAAI,EAAA,CAAA,EACzIC,EAAA,QAAQ,QAAnBL,IAAAC,EASM,MATNK,EASM,QARFL,EAOWM,EAAA,KAAAC,EANOH,EAAA,QAAPjB,QAEPa,EAGM,MAAA,KAL4Cb,EAE7C,MAAKqB,EAAA,CAAC,iCAAgC,CAAA,OAAiBC,EAAA,aAAetB,CAAG,CAAA,CAAA,IACjEiB,EAAA,KAAKjB,CAAG,EAAE,UAAnBa,EAAqD,IAAA,OAA3B,MAAKQ,EAAEJ,EAAA,KAAKjB,CAAG,EAAE,IAAI,qBAAMuB,EAAA,IACrDR,EAAGE,EAAA,KAAKjB,CAAG,EAAE,KAAK,EAAA,CAAA,4BAKlCc,EAMM,MANNL,EAMM,CAHFe,EAEsBC,EAAA,CADX,eAAgBR,EAAA,MAAM,EAAU,MAAOK,EAAA,MAAc,QAASA,EAAA,gDAG7ER,EAiBM,MAjBNJ,EAiBM,CAhBFI,EAKS,SAAA,CAJL,KAAK,SACL,MAAM,oBACL,4BAAOG,EAAA,WAAAA,EAAA,UAAA,GAAAS,CAAA,EACR,EAAAX,EAAAO,EAAA,cAAc,MAAM,EAAA,CAAA,EAExBR,EASS,SAAA,CARL,KAAK,SACL,MAAM,kBACL,4BAAOG,EAAA,WAAAA,EAAA,UAAA,GAAAS,CAAA,SACRJ,EAAA,cAAc,UAAU,EAAG,IAC3B,CAAA,EAAAK,EAAAb,EAGK,IAHLH,EAGK,KAAA,GAAA,EAAA,IADOK,EAAA,QAAQ,sCC2B/BxB,EAAU,CACb,KAAM,aACN,KAAM,UAAY,CAChB,MAAO,CACL,KAAM,cACN,aAAc,EAChB,CACF,EACA,MAAO,CACL,MAAO,CAAA,EACP,GAAI,GACJ,gBAAiB,GACjB,OAAQ,IAEV,SAAU,CACR,OAAQ,CACN,OAAO,KAAK,MAAM,KAAK,EAAE,GAAK,CAAA,CAChC,GAEF,QAAS,CACP,aAAc,CAChB,OAAO,mBAAmB,KAAK,eAAgB,KAAK,EAAE,CACpD,EACA,YAAYoC,EAAI,CAClB,OAAO,mBAAmB,KAAK,eAAgBA,CAAE,CAC/C,EACA,QAAQzB,EAAK,CACX,QAAQ,IAAIA,CAAG,CACjB,EACA,YAAa,CACN,QAAQ,KAAK,KAAK,cAAc,GAErC,OAAO,mBAAmB,KAAK,cAAe,CAC5C,GAAI,KAAK,GACV,CACH,EACA,cAAe,CAET,KAAK,MAAM,OAAS,MACtB,OAAO,mBAAmB,KAAK,YAAa,CAC1C,GAAI,KAAK,GACT,SAAU,CAAC,CACT,GAAI,SACJ,MAAO,CACL,KAAM,GAER,OAAQ,KAAK,GACd,EACF,EAED,OAAO,mBAAmB,KAAK,iBAAkB,CAC/C,GAAI,KAAK,GACV,CAEL,CACF,CACF,WA3G+B,iBAAe,QAAQ,kBAAgB,QAAQ,EAAE,sCAClD,iBAAe,QAAQ,kBAAgB,QAAQ,EAAE,uCAInE,MAAM,aAEV,MAAM,WAAW,MAAM,cAItB,MAAM,gBAAgB,kBAAgB,sBAKxCO,EAAA,CAAA,MAAM,uBAAuB,iFA7BnCG,EA2DM,MAAA,CA3DD,MAAKQ,EAAA,CAAC,aAAY,CAAA,SAAmBL,EAAA,kBAAoBA,EAAA,EAAE,CAAA,CAAA,IAC/DF,EA2BM,MAAA,CA3BD,MAAKO,EAAA,CAAC,sEAAsE,CAAA,SAAoBL,EAAA,OAAM,CAAA,IAKnGC,EAAA,MAAM,OAASA,EAAA,MAAM,kBAH5BJ,EAYM,MAAA,OAXJ,QAAKgB,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAC,GAAER,EAAA,aAAY,CAAIA,EAAA,cACxB,MAAM,sCAEN,MAAM,6BACN,KAAK,OACL,QAAQ,YACR,eAAa,MACb,OAAO,iBAEMA,EAAA,uBAAbV,IAAAC,EAA0G,OAA1GP,CAA0G,GAC9FgB,EAAA,cAAZV,IAAAC,EAA0G,OAA1GN,CAA0G,wBAE3GO,EAGM,MAAA,CAHD,MAAM,gDAAiD,8BAAeG,EAAA,aAAAA,EAAA,YAAA,GAAAS,CAAA,EAAW,CAAA,SAAA,CAAA,SAClFT,EAAA,MAAM,IAAI,EAAG,IAChB,CAAA,EAA6BA,EAAA,MAAM,OAAI,UAAvCL,EAAA,EAAAC,EAA2F,SAA3FL,EAA2FO,EAAlCE,QAAM,YAAgB,MAAG,CAAA,cAEnFH,EAOM,MAPNI,EAOM,aANLJ,EAEO,OAAA,CAFD,cAAY,WAAW,MAAM,cAClCA,EAAyB,IAAA,CAAtB,MAAM,WAAW,CAAA,QAErBA,EAEM,MAFNL,EAEM,CADLK,EAA4E,IAAA,CAAzE,MAAM,4BAA6B,4BAAOG,EAAA,YAAAA,EAAA,WAAA,GAAAS,CAAA,GAAY,KAAK,KAAI,QAAM,UAI3EC,EAAAb,EA6BM,MA7BNJ,EA6BM,CA3BEO,EAAA,MAAM,OADbL,EAAA,EAAA,EAAAC,EAScM,YAJcF,EAAA,MAAM,MAAK,CAA9Bc,EAASC,SALlBC,EAScC,EAAA,CAPZ,cAAcjB,EAAA,YACd,oBAAmBD,EAAA,gBACnB,MAAOA,EAAA,MAEP,IAAKgB,EACL,GAAID,EACJ,OAAQf,EAAA,yFAGHC,EAAA,MAAM,kBADbJ,EAiBM,MAAA,OAfJ,8BAAeI,EAAA,cAAAA,EAAA,aAAA,GAAAS,CAAA,EAAY,CAAA,SAAA,CAAA,GAC5B,MAAM,4EAENZ,EASM,MAAA,CARL,MAAM,6BACN,KAAK,OACL,QAAQ,YACR,eAAa,MACb,OAAO,eACP,MAAM,gBAENA,EAAkF,OAAA,CAA5E,iBAAe,QAAQ,kBAAgB,QAAQ,EAAE,iCAE5CG,EAAA,MAAM,MAAI,WAAtBJ,EAA6D,OAAAF,EAAAI,EAAzBO,EAAA,KAAK,UAAU,EAAA,CAAA,QACnDT,EAA2C,OAAAsB,EAAApB,EAA3BO,EAAA,KAAK,YAAY,EAAA,CAAA,yBA3BQA,EAAA,YAAY,oCCtBzD,OAAO,mBAAqBc,IAE5B,OAAO,WAAaC,EAAU,CAC5B,KAAM,KAAO,CACX,MAAO,uBACP,OAAQ,CAAA,EACR,QAAS,CACP,QAAS,GACT,KAAM,EACZ,EACI,SAAU,GACV,EAAG,GACH,gBAAiB,GACjB,MAAO,KACP,aAAc,GACd,UAAW,mBACX,cAAe,KACf,MAAM,CAAA,EACN,QAAQ,CAAA,EACR,OAAQ,CACJ,CACE,GAAM,QACN,KAAQ,QACR,UAAa,OACb,MAAS,QACT,WAAc,GACd,MAAS,OACnB,CACA,CACA,GACE,SAAU,CACR,KAAK,aAAY,EAEjB,KAAK,UAAU,IAAM,CACnB,OAAO,iBAAiB,UAAYC,GAAe,CACjD,GAAI,CACF,MAAMC,EAAU,KAAK,MAAMD,EAAW,IAAI,EAC1C,GAAIC,GAAS,OACX,OAAQA,GAAS,OAAM,CACrB,IAAK,cACH,KAAK,oBAAoBA,GAAS,KAAK,EAAE,EACzC,MACJ,IAAK,iBACH,KAAK,aAAe,GACpB,KACd,CAEQ,OAASC,EAAO,CACd,QAAQ,IAAIA,CAAK,CACnB,CACF,CAAC,EAED,KAAK,YAAY,CACf,OAAQ,YACR,KAAM,KAAK,KACnB,CAAO,CACH,CAAC,EACD,OAAO,mBAAmB,GAAG,cAAgBC,GAAS,CACpD,KAAK,WAAWA,CAAI,CACtB,CAAC,EACD,OAAO,mBAAmB,GAAG,iBAAmBA,GAAS,CACvD,KAAK,aAAe,GACpB,KAAK,cAAgBA,GAAM,EAC7B,CAAC,EAGD,OAAO,mBAAmB,GAAG,YAAcA,GAAS,CACtCA,GAAM,UAAU,QAAWA,EAAK,IAC1CA,GAAM,UAAU,QAAS5C,GAAS,CAEhC,KAAK,WAAW4C,EAAK,GAAI,CAAE,GAAG5C,CAAI,CAAE,CACtC,CAAC,CAEL,CAAC,EACD,OAAO,mBAAmB,GAAG,eAAiB+B,GAAO,CACnD,KAAK,YAAYA,CAAE,CACrB,CAAC,CACH,EACA,SAAU,CACR,eAAgB,UAAY,CAC1B,MAAMc,EAAM,CAAA,EACZ,OAAK,KAAK,GAEV,OAAO,QAAQ,KAAK,MAAM,EAAE,QAAQ,CAAC,CAACC,EAASC,CAAK,IAAM,CACxDF,EAAIC,CAAO,EAAI,OAAO,OAAO,CAAA,EAAIC,CAAK,EACtCF,EAAIC,CAAO,EAAE,MACXC,EAAM,MAAM,OAAQ/C,GACXA,EAAK,KAAK,YAAW,EAAG,SAAS,KAAK,EAAE,YAAW,CAAE,CAC7D,GAAK,CAAA,CACV,CAAC,EACM6C,GATa,KAAK,MAU3B,EACA,eAAgB,CACd,IAAIA,EAAM,CAAA,EACV,cAAO,QAAQ,KAAK,MAAM,EAAE,QAAQ,CAAC,CAAA,CAAGE,CAAK,IAAM,CACjDA,EAAM,MAAM,QAAS/C,GAAS,CAC5B6C,EAAI7C,EAAK,EAAE,EAAIA,CACjB,CAAC,CACH,CAAC,EACM6C,CACT,EACA,cAAe,CACb,OAAO,KAAK,MAAM,KAAK,eAAe,EAAE,OAAS,EACnD,EACA,qBAAsB,CACpB,OAAO,KAAK,cAAc,KAAK,MAAM,KAAK,eAAe,EAAE,IAAI,GAAK,EACtE,CACJ,EACE,MAAO,CACL,aAAavC,EAAK,CAChB,QAAQ,IAAIA,CAAG,CACjB,CACJ,EACE,QAAS,CACP,YAAYsC,EAAM,CAChB,MAAMI,EAAW,SAAS,eAAe,eAAe,EACpDA,GAAYA,EAAS,eACvBA,EAAS,cAAc,YAAY,KAAK,UAAUJ,CAAI,EAAG,GAAG,CAEhE,EACA,cAAe,CACb,IAAIhD,EAAK,KAET,OAAO,KAAK,CACV,IAAK,YAAY,UAAY,6BAC7B,SAAU,OACV,KAAM,MACN,QAAS,SAAUiD,EAAK,CAClBA,EAAI,SACNjD,EAAG,OAASiD,EAAI,KAEpB,EACA,MAAO,SAAUI,EAAG,CAClB,QAAQ,IAAIA,CAAC,CACf,CACR,CAAO,CACH,EACA,YAAYlB,EAAI,CACd,KAAK,gBAAkBA,EACvB,KAAK,YAAY,CACf,OAAQ,cACR,KAAMA,CACd,CAAO,CACH,EACA,oBAAoBA,EAAI,CACtB,KAAK,gBAAkBA,CACzB,EACA,cAAe,CACb,IAAInC,EAAK,KAET,KAAK,SAAW,GAEhB,EAAE,KAAK,CACL,IAAK,YAAY,UAAY,yBAC7B,SAAU,OACV,KAAM,OACN,KAAM,CACJ,GAAI,YACJ,QAAS,KAAK,UAAU,KAAK,KAAK,EAClC,MAAO,KAAK,MACZ,KAAM,iBAChB,EACQ,QAAS,SAAUiD,EAAK,CACtBjD,EAAG,SAAW,GACdA,EAAG,UAAYiD,EAAI,UACfA,EAAI,UACNjD,EAAG,QAAQ,QAAUiD,EAAI,QACzBjD,EAAG,QAAQ,KAAOiD,EAAI,QAEpBA,EAAI,MACN,OAAO,SAAS,KAAOA,EAAI,KAG7B,OAAO,WAAW,IAAM,CACtBjD,EAAG,QAAQ,QAAU,EACvB,EAAG,GAAI,CACT,EACA,MAAO,SAAUqD,EAAG,CAClBrD,EAAG,SAAW,GAEVqD,EAAE,aAAa,SACjBrD,EAAG,QAAQ,QAAUqD,EAAE,aAAa,QACpCrD,EAAG,QAAQ,KAAO,KAElBA,EAAG,QAAQ,QAAU,oBACrBA,EAAG,QAAQ,KAAO,GAEtB,CACR,CAAO,CACH,EACA,YAAa,CACX,KAAK,gBAAkB,EACzB,EACA,UAAUsD,EAAO,CACX,KAAK,iBAAmB,KAAK,MAAM,KAAK,eAAe,IACzD,KAAK,MAAM,KAAK,eAAe,EAAE,MAAQA,EACzC,KAAK,YAAY,CACf,OAAQ,aACR,KAAM,CACJ,GAAI,KAAK,gBACT,MAAAA,EACA,KAAM,KAAK,iBAAiB,KAAK,eAAe,CAC5D,CACA,CAAS,EACD,KAAK,aAAY,EAErB,EACA,QAAQ5C,EAAK,CACX,KAAK,aAAY,EACjB,KAAK,YAAY,CACf,OAAQ,WACR,KAAMA,EAAI,KAClB,CAAO,CACH,EACA,WAAWsC,EAAM,CACf,MAAMO,EAASP,EAAK,GACdQ,EAAU,KAAK,MAAMD,CAAM,EACjC,GAAI,OAAOC,EAAY,IAAa,CAClC,KAAK,gBAAkB,GAEvB,MAAMC,EAAc,KAAK,MAAMD,EAAQ,MAAM,EAAE,MAC3C,OAAOC,EAAgB,KAAeA,EAAY,QAAQF,CAAM,IAAM,IACxE,KAAK,MAAMC,EAAQ,MAAM,EAAE,MAAM,OAAOC,EAAY,QAAQF,CAAM,EAAG,CAAC,EAExE,OAAO,KAAK,MAAMA,CAAM,EAExB,KAAK,YAAY,CACf,OAAQ,cACR,KAAAP,CACV,CAAS,EACD,KAAK,aAAY,CACnB,CACF,EACA,SAASU,EAAO,CACd,KAAK,WAAW,KAAK,eAAiB,OAAQA,CAAK,CACrD,EACA,WAAWC,EAAUD,EAAOE,EAAS,CACnC,MAAMC,EAAQ,KAAK,OAAO,EAAE,EAItBC,EAAY,KAAK,cAAcJ,EAAM,EAAE,EAC7C,GAAI,CAACI,EAAW,CACd,QAAQ,IAAI,eAAgBA,EAAWJ,CAAK,EAC5C,MACF,CAEA,MAAMK,EAAc,KAAK,eAAe,CAAE,GAAGD,CAAS,CAAE,EAGxD,GADAC,EAAY,OAASJ,EACjB,CAAC,KAAK,MAAMA,CAAQ,EAAG,CACzB,QAAQ,IAAI,cAAgBA,EAAUG,EAAWJ,CAAK,EACtD,MACF,CAEA,KAAK,MAAMC,CAAQ,EAAE,MAAQ,KAAK,MAAMA,CAAQ,EAAE,OAAS,GAE3D,KAAK,MAAMA,CAAQ,EAAE,MAAM,KAAKE,CAAK,EACrC,KAAK,MAAMA,CAAK,EAAIE,EAEhBJ,IAAa,OAGf,KAAK,YAAY,CACf,OAAQ,aACR,KAAM,CACJ,GAAIA,EACJ,MAAO,CAAA,EACP,KAAM,KAAK,iBAAiB,KAAK,QAAQ,CACrD,CACA,CAAS,EAGD,KAAK,YAAY,CACf,OAAQ,YACR,KAAM,CACJ,GAAIE,EACJ,MAAOH,EAAM,MACb,UAAWA,EAAM,EAC7B,CACA,CAAS,EAKSA,EAAM,iBAAiB,QAIjCA,EAAM,gBAAgB,QAASM,GAAW,CACxC,MAAMC,EAAW,CAAE,GAAGD,GAEtB,KAAK,WAAWH,EAAOI,EAAU,CAC/B,cAAe,EAC3B,CAAW,CACH,CAAC,EAGH,KAAK,UAAU,IAAM,CAGf,CAASL,GAAS,eAAkBD,IAAa,QACnD,KAAK,YAAYE,CAAK,EAExB,KAAK,aAAe,EACtB,CAAC,CACH,EACA,eAAeH,EAAO,CACpB,IAAIT,EAAM,CACR,KAAMS,EAAM,GACZ,KAAMA,EAAM,KACZ,MAAOA,EAAM,MACb,UAAWA,EAAM,UACjB,KAAM,EACd,EAEM,OAAIA,EAAM,eACRT,EAAI,aAAe,GACnBA,EAAI,SAAW,IAGVA,CACT,EACA,OAAOiB,EAAQ,CACb,IAAIC,EAAS,GACb,MAAMC,EAAa,iEACbC,EAAmBD,EAAW,OACpC,IAAIE,EAAU,EACd,KAAOA,EAAUJ,GACfC,GAAUC,EAAW,OAAO,KAAK,MAAM,KAAK,OAAM,EAAKC,CAAgB,CAAC,EACxEC,GAAW,EAEb,OAAOH,EAAO,aAChB,EAEA,iBAAiBI,EAAQC,EAAQ,EAAG,CAClC,IAAIvB,EAAM,CAAA,EACV,OAAIuB,IAAU,GAAK,KAAK,MAAMD,CAAM,IAElCtB,EAAIsB,CAAM,EAAI,KAAK,MAAMA,CAAM,GAErB,KAAK,MAAMA,CAAM,GAAG,OAC9B,KAAK,MAAMA,CAAM,EAAE,MAAM,QAASE,GAAgB,CAC5C,KAAK,MAAMA,CAAW,IACxBxB,EAAIwB,CAAW,EAAI,KAAK,MAAMA,CAAW,GAI3CxB,EAAM,CAAE,GAAGA,EAAK,GAAG,KAAK,iBAAiBwB,EAAaD,EAAQ,CAAC,EACjE,CAAC,EAEIvB,CACT,CACJ,EACE,WAAY,CACV,UAAWyB,EACX,UAAAC,EACA,UAAAC,EACA,iBAAAjE,CACJ,CACA,CAAC,EAED,OAAO,WAAW,MAAM,cAAc,EAEtCkE,EAAQ,OAAO,UAAU"}