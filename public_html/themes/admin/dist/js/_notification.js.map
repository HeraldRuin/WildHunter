{"version":3,"file":"_notification.js","sources":["../../js/_notification.js"],"sourcesContent":["jQuery(function($){\r\n\r\n    var notificationsWrapper   = $('.dropdown-notifications');\r\n    var notificationsToggle    = notificationsWrapper.find('div[data-toggle]');\r\n    var notificationsCountElem = notificationsToggle.find('.notification-icon');\r\n    var notificationsCount     = parseInt(notificationsCountElem.html());\r\n    var notifications          = notificationsWrapper.find('ul.dropdown-list-items');\r\n\r\n\r\n    $(document).on(\"click\",\".markAsRead\",function(e) {\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n        var id = $(this).data('id');\r\n        var url = $(this).attr('href');\r\n        $.ajax({\r\n            url: bookingCore.markAsRead,\r\n            data: {'id' : id },\r\n            method: \"post\",\r\n            success:function (res) {\r\n                window.location.href = url;\r\n            }\r\n        })\r\n    });\r\n\r\n    $(document).on(\"click\",\".markAllAsRead\",function(e) {\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n        $.ajax({\r\n            url: bookingCore.markAllAsRead,\r\n            method: \"post\",\r\n            success:function (res) {\r\n                $('.dropdown-notifications').find('li.notification').removeClass('active');\r\n                notificationsCountElem.text(0);\r\n                notificationsWrapper.find('.notif-count').text(0);\r\n            }\r\n        })\r\n    });\r\n\r\n    if(bookingCore.pusher_api_key && bookingCore.pusher_cluster){\r\n        var pusher = new Pusher(bookingCore.pusher_api_key, {\r\n            encrypted: true,\r\n            cluster: bookingCore.pusher_cluster\r\n        });\r\n    }\r\n\r\n    var callback = function(data) {\r\n        var existingNotifications = notifications.html();\r\n        var newNotificationHtml = '<li class=\"notification active\">'\r\n            +'<div class=\"media\">'\r\n            +'    <div class=\"media-left\">'\r\n            +'      <div class=\"media-object\">'\r\n            +  data.avatar\r\n            +'      </div>'\r\n            +'    </div>'\r\n            +'    <div class=\"media-body\">'\r\n            +'      <a class=\"markAsRead\" data-id=\"'+data.idNotification+'\" href=\"'+data.link+'\">'+data.message+'</a>'\r\n            +'      <div class=\"notification-meta\">'\r\n            +'        <small class=\"timestamp\">about a few seconds ago</small>'\r\n            +'      </div>'\r\n            +'    </div>'\r\n            +'  </div>'\r\n            +'</li>';\r\n        notifications.html(newNotificationHtml + existingNotifications);\r\n\r\n        notificationsCount += 1;\r\n        notificationsCountElem.text(notificationsCount);\r\n        notificationsWrapper.find('.notif-count').text(notificationsCount);\r\n    };\r\n\r\n    if(bookingCore.isAdmin > 0 && bookingCore.pusher_api_key){\r\n        var channel = pusher.subscribe('admin-channel');\r\n        channel.bind('App\\\\Events\\\\PusherNotificationAdminEvent', callback);\r\n    }\r\n\r\n    if(bookingCore.currentUser > 0 && bookingCore.pusher_api_key){\r\n        var channelPrivate = pusher.subscribe('user-channel-'+bookingCore.currentUser);\r\n        channelPrivate.bind('App\\\\Events\\\\PusherNotificationPrivateEvent', callback);\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n\r\n});\r\n"],"names":["$","notificationsWrapper","notificationsToggle","notificationsCountElem","notificationsCount","notifications","e","id","url","res","pusher","callback","data","existingNotifications","newNotificationHtml","channel","channelPrivate"],"mappings":"AAAA,OAAO,SAASA,EAAE,CAEd,IAAIC,EAAyBD,EAAE,yBAAyB,EACpDE,EAAyBD,EAAqB,KAAK,kBAAkB,EACrEE,EAAyBD,EAAoB,KAAK,oBAAoB,EACtEE,EAAyB,SAASD,EAAuB,KAAI,CAAE,EAC/DE,EAAyBJ,EAAqB,KAAK,wBAAwB,EAgC/E,GA7BAD,EAAE,QAAQ,EAAE,GAAG,QAAQ,cAAc,SAASM,EAAG,CAC7CA,EAAE,gBAAe,EACjBA,EAAE,eAAc,EAChB,IAAIC,EAAKP,EAAE,IAAI,EAAE,KAAK,IAAI,EACtBQ,EAAMR,EAAE,IAAI,EAAE,KAAK,MAAM,EAC7BA,EAAE,KAAK,CACH,IAAK,YAAY,WACjB,KAAM,CAAC,GAAOO,CAAE,EAChB,OAAQ,OACR,QAAQ,SAAUE,EAAK,CACnB,OAAO,SAAS,KAAOD,CAC3B,CACZ,CAAS,CACL,CAAC,EAEDR,EAAE,QAAQ,EAAE,GAAG,QAAQ,iBAAiB,SAASM,EAAG,CAChDA,EAAE,gBAAe,EACjBA,EAAE,eAAc,EAChBN,EAAE,KAAK,CACH,IAAK,YAAY,cACjB,OAAQ,OACR,QAAQ,SAAUS,EAAK,CACnBT,EAAE,yBAAyB,EAAE,KAAK,iBAAiB,EAAE,YAAY,QAAQ,EACzEG,EAAuB,KAAK,CAAC,EAC7BF,EAAqB,KAAK,cAAc,EAAE,KAAK,CAAC,CACpD,CACZ,CAAS,CACL,CAAC,EAEE,YAAY,gBAAkB,YAAY,eACzC,IAAIS,EAAS,IAAI,OAAO,YAAY,eAAgB,CAChD,UAAW,GACX,QAAS,YAAY,cACjC,CAAS,EAGL,IAAIC,EAAW,SAASC,EAAM,CAC1B,IAAIC,EAAwBR,EAAc,OACtCS,EAAsB,kHAInBF,EAAK,OACP,0FAGwCA,EAAK,eAAe,WAAWA,EAAK,KAAK,KAAKA,EAAK,QAAQ,+IAOxGP,EAAc,KAAKS,EAAsBD,CAAqB,EAE9DT,GAAsB,EACtBD,EAAuB,KAAKC,CAAkB,EAC9CH,EAAqB,KAAK,cAAc,EAAE,KAAKG,CAAkB,CACrE,EAEA,GAAG,YAAY,QAAU,GAAK,YAAY,eAAe,CACrD,IAAIW,EAAUL,EAAO,UAAU,eAAe,EAC9CK,EAAQ,KAAK,4CAA6CJ,CAAQ,CACtE,CAEA,GAAG,YAAY,YAAc,GAAK,YAAY,eAAe,CACzD,IAAIK,EAAiBN,EAAO,UAAU,gBAAgB,YAAY,WAAW,EAC7EM,EAAe,KAAK,8CAA+CL,CAAQ,CAC/E,CAOJ,CAAC"}