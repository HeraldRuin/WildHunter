{"version":3,"file":"_menu.js","sources":["../../js/_menu.js"],"sourcesContent":["import { createApp } from 'vue'\r\nimport { Draggable } from '@he-tree/vue'\r\n\r\n(function ($) {\r\n    var id = $('#menu-app');\r\n    if (!id.length) {\r\n        return;\r\n    }\r\n    var menu_id = id.data('id');\r\n\r\n    createApp({\r\n        components: {\r\n            Draggable\r\n        },\r\n        data: ()=>({\r\n            items: current_menu_items,\r\n            item_types: [],\r\n            custom_url: '',\r\n            custom_name: \"\",\r\n            name: current_menu_name,\r\n            message: {\r\n                type: false,\r\n                content: ''\r\n            },\r\n            custom_show: false,\r\n            locations: current_menu_locations,\r\n            currentIndex: current_items_index + 1,\r\n            triggerClass: { default: \"drag-trigger\" }\r\n        }),\r\n        mounted() {\r\n            this.reloadTypes();\r\n            // if(menu_id){\r\n            //     this.reloadItems();\r\n            // }\r\n\r\n        },\r\n        methods: {\r\n            toogleItem(item) {\r\n                if (item._open) {\r\n                    item._open = false;\r\n                } else {\r\n                    item._open = true;\r\n                }\r\n            },\r\n            searchItems(type) {\r\n                // if(!type.q) return;\r\n                $.ajax({\r\n                    url: bookingCore.admin_url + '/module/core/menu/searchTypeItems',\r\n                    data: {\r\n                        class: type.class,\r\n                        q: type.q\r\n                    },\r\n                    dataType: 'json',\r\n                    type: 'post',\r\n                    success: function (res) {\r\n                        if (res.status) {\r\n                            type.items = res.data;\r\n                        }\r\n                    },\r\n                    error: function (e) {\r\n                        console.log(e);\r\n                    }\r\n                })\r\n            },\r\n            reloadItems() {\r\n                var me = this;\r\n                $.ajax({\r\n                    url: bookingCore.admin_url + '/module/core/menu/getItems',\r\n                    dataType: 'json',\r\n                    type: 'post',\r\n                    data: {\r\n                        id: menu_id\r\n                    },\r\n                    success: function (res) {\r\n                        if (res.data && res.status) {\r\n                            me.items = res.data;\r\n                        }\r\n                    },\r\n                    error: function (e) {\r\n                        console.log(e);\r\n                    }\r\n                })\r\n            },\r\n            reloadTypes() {\r\n                var me = this;\r\n                $.ajax({\r\n                    url: bookingCore.admin_url + '/module/core/menu/getTypes',\r\n                    dataType: 'json',\r\n                    type: 'post',\r\n                    data: {},\r\n                    success: function (res) {\r\n                        if (res.data && res.status) {\r\n                            me.item_types = res.data;\r\n                        }\r\n                    },\r\n                    error: function (e) {\r\n                        console.log(e);\r\n                    }\r\n                })\r\n            },\r\n            addToMenu(type) {\r\n                if (!type.selected.length) {\r\n                    return false;\r\n                }\r\n\r\n                for (var i = 0; i < type.items.length; i++) {\r\n                    if (type.selected.indexOf(type.items[i].id) > -1) {\r\n\r\n                        var item = Object.assign({}, type.items[i]);\r\n                        // item._id = this.currentIndex + 1;\r\n                        item._open = true;\r\n                        this.items.push(item);\r\n\r\n                        this.currentIndex += 1;\r\n\r\n                        console.log(this.currentIndex);\r\n                    }\r\n                }\r\n\r\n                type.selected = [];\r\n\r\n            },\r\n            addCustomUrl() {\r\n                if (!this.custom_name) return;\r\n\r\n                this.items.push({\r\n                    name: this.custom_name,\r\n                    url: this.custom_url,\r\n                    item_model: 'custom',\r\n                    _open: false,\r\n                    // _id: this.items.length + 1\r\n                });\r\n\r\n                this.custom_name = '';\r\n                this.custom_url = '';\r\n            },\r\n            parseMenuItems:function(origins){\r\n                var items = [];\r\n\r\n                for(var i  = 0; i < origins.length; i++){\r\n                    var item = origins[i];\r\n                    var tmp = Object.assign({},item);\r\n\r\n                    delete tmp._vm;\r\n                    delete tmp.parent;\r\n                    delete tmp.style;\r\n                    delete tmp.children;\r\n                    delete tmp.style;\r\n                    delete tmp.innerStyle;\r\n                    delete tmp.innerBackClass;\r\n                    delete tmp.innerBackStyle;\r\n\r\n                    if(item.children){\r\n                        tmp.children = this.parseMenuItems(item.children);\r\n                    }\r\n\r\n                    items.push(tmp);\r\n\r\n\r\n                }\r\n                return items;\r\n\r\n            },\r\n            saveMenu() {\r\n                var me = this;\r\n\r\n                var items = this.parseMenuItems(this.items);\r\n\r\n                $.ajax({\r\n                    url: bookingCore.admin_url + '/module/core/menu/store',\r\n                    dataType: 'json',\r\n                    type: 'post',\r\n                    data: {\r\n                        id: menu_id,\r\n                        items: JSON.stringify(items),\r\n                        name: this.name,\r\n                        locations: this.locations,\r\n                        lang:current_menu_lang\r\n                    },\r\n                    success: function (res) {\r\n                        if (res.message) {\r\n                            me.message.content = res.message;\r\n                            me.message.type = res.status;\r\n                        }\r\n                        if (res.url) {\r\n                            window.location.href = res.url;\r\n                        }\r\n                    },\r\n                    error: function (e) {\r\n                        if (e.responseJSON.message) {\r\n                            me.message.content = e.responseJSON.message;\r\n                            me.message.type = false;\r\n                        } else {\r\n\r\n                            me.message.content = 'Can not save menu';\r\n                            me.message.type = false;\r\n                        }\r\n\r\n                    }\r\n                })\r\n            },\r\n            deleteMenuItem(e, item,tree,path) {\r\n                e.preventDefault();\r\n                tree.removeNodeByPath(path);\r\n            }\r\n        }\r\n    }).mount('#menu-app');\r\n\r\n})(jQuery);\r\n"],"names":["$","id","menu_id","createApp","Draggable","item","type","res","e","me","i","origins","items","tmp","tree","path"],"mappings":"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"}