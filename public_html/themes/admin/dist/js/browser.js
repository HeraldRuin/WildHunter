import{h as a}from"./vendor.js";import{f as d,a as r}from"./app.js";import"./custom-fields.js";(function(i){window.uploaderModalApp=a({data(){return{files:[],viewType:"grid",total:0,totalPage:0,fileTypes:[],selected:[],selectedLists:[],showUploader:!1,apiFinished:!1,modalEl:!1,multiple:!1,isLoading:!1,filter:{page:1},onSelect:function(){},uploadConfigs:{file_type:"default"},currentFolder:{id:0,onEdit:!1},folders:[],breadcrumbs:[],accept_type:bookingCore.media.groups.default.mime.join(",")}},mounted(){let e=this;if(this.modalEl=i("#cdn-browser-modal").modal({show:!1}).on("show.bs.modal",function(){e.reloadLists(),e.reloadFolder()}),this.$nextTick(function(){i(this.$refs.files).change(function(){e.upload(this.files)})}),window.localStorage){const t=window.localStorage.getItem("bc_media_view_type");t&&(this.viewType=t)}},watch:{uploadConfigs(e){this.multiple=e.multiple,this.onSelect=e.onSelect}},methods:{deletedFolder:function(e){this.folders.splice(e,1)},setViewType:function(e){this.viewType=e,window.localStorage&&window.localStorage.setItem("bc_media_view_type",e)},toggleEditFolder:function(e,t){this.folders[e].onEdit=t},reloadAll:function(){this.filter.page=1,this.reloadLists(),this.reloadFolder()},toFolderRoot:function(){this.breadcrumbs=[],this.currentFolder={id:0,parent_id:0},this.filter.page=1,this.reloadLists(),this.reloadFolder()},showFolder:function(e,t){e.id!==this.currentFolder.id&&(this.breadcrumbs.push(e),typeof t<"u"&&this.breadcrumbs.splice(t,this.breadcrumbs.length-1-t),this.currentFolder=e,this.filter.page=1,this.reloadLists(),this.reloadFolder())},updateFolder:function(e,t){this.folders[e]=Object.assign({},t)},addFolder:function(){this.folders.push({id:0,name:"New Folder",onEdit:!0,parent_id:this.currentFolder.id})},reloadFolder:function(){var e=this;i.ajax({url:bookingCore.url+"/media/folder",type:"get",data:{parent_id:this.currentFolder.id},dataType:"json",success:function(t){e.folders=t.data}})},show(e){this.files=[],this.resetSelected(),this.uploadConfigs=e,this.modalEl.modal("show"),this.accept_type=bookingCore.media.groups[e.file_type].mime},hide(){this.modalEl.modal("hide")},changePage(e,t){t.preventDefault(),this.filter.page=e,this.reloadLists()},selectFile(e){var t=this.selected.indexOf(e.id);t>-1?(this.selected.splice(t,1),this.selectedLists.splice(t,1)):(this.multiple||(this.selected=[],this.selectedLists=[]),this.selected.push(e.id),this.selectedLists.push(e))},removeFiles(){var e=this;bookingCoreApp.showConfirm({message:i18n.confirm_delete,callback:function(t){t&&(e.isLoading=!0,i.ajax({url:bookingCore.admin_url+"/module/media/removeFiles",type:"POST",data:{file_ids:e.selected},dataType:"json",success:function(s){s.status,s.status===0&&bookingCoreApp.showError(s),e.isLoading=!1,e.reloadLists()},error:function(s){e.isLoading=!1,bookingCoreApp.showAjaxError(s),e.resetSelected()}}))}})},sendFiles(){if(typeof this.onSelect=="function"){let e=this.onSelect;e(this.selectedLists)}this.hide()},init(){this.reloadLists()},reloadLists(){var e=this;i("#cdn-browser .icon-loading").addClass("active"),e.isLoading=!0,i.ajax({url:bookingCore.admin_url+"/module/media/getLists",type:"POST",data:{file_type:this.uploadConfigs.file_type,page:this.filter.page,s:this.filter.s,folder_id:this.currentFolder.id},dataType:"json",success:function(t){e.resetSelected(),e.files=t.data,e.total=t.total,e.totalPage=t.totalPage,e.isLoading=!1,e.apiFinished=!0}})},upload(e){var t=this;if(e.length)for(var s=0;s<e.length;s++){var l=new FormData;l.append("file",e[s]),l.append("type",this.uploadConfigs.file_type),l.append("folder_id",this.currentFolder.id),t.isLoading=!0,i.ajax({url:bookingCore.admin_url+"/module/media/store",data:l,dataType:"json",type:"post",contentType:!1,processData:!1,success:function(o){t.isLoading=!1,o.status&&t.reloadLists(),o.status===0&&bookingCoreApp.showError(o),i(t.$refs.files).val("")},error:function(o){bookingCoreApp.showAjaxError(o),i(t.$refs.files).val(""),t.isLoading=!1}})}},initUploader(){},resetSelected(){this.selectedLists=[],this.selected=[],this.total=0,this.totalPage=0,this.apiFinished=!1}},components:{fileItem:r,folderItem:d}}),window.uploaderModal=window.uploaderModalApp.mount("#cdn-browser")})(jQuery);
//# sourceMappingURL=browser.js.map
