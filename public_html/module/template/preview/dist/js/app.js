window.LivePreview=new Vue({data:{message:{content:"",type:!1},onSaving:!1,s:"",selectedBlockId:""},watch:{selectedBlockId(t){const e=document.getElementsByClassName("live-block-preview");for(let o=0;o<e.length;o++)e[o].classList.remove("selected");const s=t.replace(".","");document.getElementById("block-"+s).classList.add("selected")}},methods:{init(){this.$nextTick(()=>{window.addEventListener("message",t=>{let e=null;try{e=JSON.parse(t.data)}catch(s){console.log(s);return}if(console.log(e),e?.action)switch(e?.action){case"set_items":this.setItems(e?.data);break;case"select-item":const s=e.data.replace(".","");$("body,html").animate({scrollTop:$("#block-"+s).offset().top},"fast"),this.selectedBlockId=e.data;break;case"save_block":this.updateBlock(e.data.id,e.data.model,e.data.tree);break;case"sort-end":this.sortEndFromParent(e.data);break;case"delete-item":this.deleteItemFromParent(e.data);break;case"add_block":this.addItemFromParent(e.data.id,e.data.model,e.data.blockType);break}})})},setItems(t){this[t]=t},selectItem(t){this.selectedBlockId=t,this.sendToParent({action:"select-item",data:{id:t}})},updateBlock(t,e,s){const o=t.replace(".",""),a=$("#block-"+o).attr("wire:id"),n=Livewire.find(a);if(n){if(Object.keys(e)?.length)for(const d in e)n.$set(d,e[d],!1);n.preview(s)}},sortEndFromParent(t){const e=t.element,s=t.newIndex,o=t.oldIndex,a=this.items.ROOT.nodes;a.splice(o,1),a.splice(s,0,e),this.items.ROOT.nodes=a},deleteItemFromParent(t){const e=t.id.replace(".","");document.getElementById(`block-${e}`).remove()},addItemFromParent(t,e,s){$.ajax({url:bookingCore.admin_url+"/module/template/live/block-preview",dataType:"json",type:"post",data:{block:s,model:e,nodeId:t},success:o=>{o.preview&&($(".page-template-content").append(o.preview),setTimeout(()=>{this.scrollToItem(t)},100))},error:o=>{console.log(o)}})},scrollToItem(t){const e=t.replace(".","");$("body,html").animate({scrollTop:document.getElementById("block-"+e).offsetTop},"fast")},showAddLayer(){this.sendToParent({action:"show-add-layer"})},sendToParent(t){window.parent.postMessage(JSON.stringify(t),"*")}}});window.LivePreview.init();$("a").on("click",function(t){t.preventDefault()});
